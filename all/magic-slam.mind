{"root":{"data":{"id":"deyl0s661e80","created":1765780711267,"text":"magic-slam"},"children":[{"data":{"id":"deyl0toq99s0","created":1765780714567,"text":"configs"},"children":[{"data":{"id":"deyl5tfpj1k0","created":1765781105842,"text":"Aria"},"children":[]},{"data":{"id":"deyl5wcwmk80","created":1765781112203,"text":"Replica"},"children":[]}]},{"data":{"id":"deyl5ggwfu80","created":1765781077616,"text":"代码仓"},"children":[{"data":{"id":"deyl60skjc00","created":1765781121857,"text":"src"},"children":[{"data":{"id":"deyl72eb33c0","created":1765781203712,"text":"entities","expandState":"expand"},"children":[{"data":{"id":"deyl78h8jmo0","created":1765781216950,"text":"loop_detection","expandState":"expand"},"children":[{"data":{"id":"deyl9tpq03c0","created":1765781419904,"text":"feature_extractors.py","expandState":"expand"},"children":[{"data":{"id":"deyla9vagsg0","created":1765781455069,"text":"父类class BaseFeatureExtractor","expandState":"expand"},"children":[{"data":{"id":"dezez46hekg0","created":1765865213977,"text":"传入"},"children":[{"data":{"id":"dezf0zyimr40","created":1765865361516,"text":"config"},"children":[]}]},{"data":{"id":"dezez8g26ug0","created":1765865223263,"text":"函数","expandState":"expand"},"children":[{"data":{"id":"deylaoyfxko0","created":1765781487912,"text":"extract_features(image: Image)","expandState":"collapse"},"children":[{"data":{"id":"dezf58qsiow0","created":1765865694097,"text":"传入image","font-weight":"bold"},"children":[]},{"data":{"id":"dezf59o2fdk0","created":1765865696109,"text":"传出features","font-weight":"bold"},"children":[]},{"data":{"id":"dezf7z8apt40","created":1765865908480,"text":"报错：NotImplementedError"},"children":[]}]}]},{"data":{"id":"dezezd8818o0","created":1765865233673,"text":"结构","expandState":"expand"},"children":[{"data":{"id":"deyljyzob9k0","created":1765782215032,"text":"init(config)","expandState":"expand"},"children":[{"data":{"id":"deylgswanko0","created":1765781966674,"text":"config放参数文件"},"children":[]},{"data":{"id":"deylgu5a9080","created":1765781969394,"text":"weights_path模型权重"},"children":[]},{"data":{"id":"deylgyeqw0w0","created":1765781978674,"text":"device设备cpu还是gpu"},"children":[]}]}]},{"data":{"id":"dezez6sin1s0","created":1765865219663,"text":"功能目的"},"children":[{"data":{"id":"dezf1k9iqm80","created":1765865405717,"text":"输出feature","font-weight":"bold"},"children":[]}]}]},{"data":{"id":"deylg6kjf2w0","created":1765781918074,"text":"子类DINOFeatureExtractor","expandState":"collapse"},"children":[{"data":{"id":"dezez8g26ug0","created":1765865223263,"text":"函数","expandState":"expand"},"children":[{"data":{"id":"deylr6pi8ko0","created":1765782780380,"text":"extract_features()","expandState":"expand"},"children":[{"data":{"id":"dezf6vlzz680","created":1765865822237,"text":"传入传出同父类"},"children":[]},{"data":{"id":"dezf6y6fcxc0","created":1765865827826,"text":"算法"},"children":[]}]}]},{"data":{"id":"dezezd8818o0","created":1765865233673,"text":"结构","expandState":"expand"},"children":[{"data":{"id":"deylpe8jwu80","created":1765782640041,"text":"init","expandState":"collapse"},"children":[{"data":{"id":"deyls2c9wqg0","created":1765782849237,"text":"super继承父类"},"children":[]},{"data":{"id":"deylpfii6ug0","created":1765782642819,"text":"preprocess预处理"},"children":[{"data":{"id":"deylpkeew3s0","created":1765782653456,"text":"AutoImageProcessor.from_pretrained(weights_path)"},"children":[]}]},{"data":{"id":"deylpq5h5ls0","created":1765782665976,"text":"model模型"},"children":[{"data":{"id":"deylpzgvm7k0","created":1765782686257,"text":"AutoModel.from_pretrained().to()"},"children":[]}]},{"data":{"id":"deylprk0mqo0","created":1765782669032,"text":"embed_size，默认384"},"children":[]}]}]}]},{"data":{"id":"deylgb52tk00","created":1765781928023,"text":"子类NetVLADFeatureExtractor","expandState":"collapse"},"children":[{"data":{"id":"dezez8g26ug0","created":1765865223263,"text":"函数","expandState":"expand"},"children":[{"data":{"id":"deylrnuk5sw0","created":1765782817691,"text":"extract_features()"},"children":[{"data":{"id":"dezf7inrp2o0","created":1765865872410,"text":"传入传出同父类"},"children":[]},{"data":{"id":"dezf7mz1bd40","created":1765865881799,"text":"算法"},"children":[]}]}]},{"data":{"id":"dezezd8818o0","created":1765865233673,"text":"结构","expandState":"expand"},"children":[{"data":{"id":"deylrmt01nk0","created":1765782815420,"text":"init"},"children":[{"data":{"id":"deylryv6yqo0","created":1765782841674,"text":"super继承父类"},"children":[]},{"data":{"id":"deylrxvayw80","created":1765782839504,"text":"model"},"children":[{"data":{"id":"deylsj2gcmo0","created":1765782885648,"text":"NetVLAD().to()"},"children":[]},{"data":{"id":"deylso1j9eg0","created":1765782896477,"text":"model.eval()"},"children":[]}]},{"data":{"id":"deylscjt04w0","created":1765782871460,"text":"embed_size,默认4096"},"children":[]}]}]}]},{"data":{"id":"deylti8oudk0","created":1765782962213,"text":"get_feature_extractor(config: dict)","expandState":"collapse"},"children":[{"data":{"id":"dezez46hekg0","created":1765865213977,"text":"传入"},"children":[{"data":{"id":"dezf9lnoacg0","created":1765866035663,"text":"config"},"children":[]}]},{"data":{"id":"dezez6sin1s0","created":1765865219663,"text":"传出"},"children":[{"data":{"id":"dezf9ncwtuo0","created":1765866039366,"text":"特征提取器"},"children":[]}]},{"data":{"id":"dezf8tydmeg0","created":1765865975361,"text":"判断特征提取器种类","font-weight":"bold"},"children":[]}]},{"data":{"id":"dfefaa8ipts0","created":1767389488517,"text":"整体是image->feature，为之后寻找回环做准备"},"children":[]}]},{"data":{"id":"deyl9x2mviw0","created":1765781427215,"text":"loop_detector.py","expandState":"collapse"},"children":[{"data":{"id":"deylv440fz40","created":1765783088183,"text":"LoopDetector","expandState":"collapse"},"children":[{"data":{"id":"dezez46hekg0","created":1765865213977,"text":"传入"},"children":[{"data":{"id":"dezfawr7nl40","created":1765866138186,"text":"config"},"children":[]}]},{"data":{"id":"dezez8g26ug0","created":1765865223263,"text":"函数","expandState":"collapse"},"children":[{"data":{"id":"deylvhmwro00","created":1765783117624,"text":"_setup_feature_db(self)","expandState":"expand"},"children":[{"data":{"id":"dezfih1c0tc0","created":1765866730883,"text":"无传入传出"},"children":[]},{"data":{"id":"deyqeouj1js0","created":1765795906681,"text":"初始化用于存储和搜索图像特征的数据库","font-weight":"bold"},"children":[]}]},{"data":{"id":"deylvmri68w0","created":1765783128786,"text":"get_db_size(self)","expandState":"expand"},"children":[{"data":{"id":"dezfjgv3wz40","created":1765866808871,"text":"传出在database内的帧数量features_db.ntotal","expandState":"expand","font-weight":"bold"},"children":[]}]},{"data":{"id":"deylvqn8egg0","created":1765783137235,"text":"add_features","font-weight":"bold","expandState":"expand"},"children":[{"data":{"id":"dezfkwa6b0o0","created":1765866920797,"text":"传入"},"children":[{"data":{"id":"dezfl0dfh740","created":1765866929701,"text":"features: tensor"},"children":[]},{"data":{"id":"dezfl5ovcbk0","created":1765866941277,"text":"frame_ids: tensor"},"children":[]},{"data":{"id":"dezflbgbbt40","created":1765866953820,"text":"agent_id: int"},"children":[]}]},{"data":{"id":"dezfkxaryw00","created":1765866923011,"text":"将特征features加入database","font-weight":"bold"},"children":[]}]},{"data":{"id":"deylw41z27s0","created":1765783166424,"text":"clean_db()"},"children":[{"data":{"id":"dezfo5oy8080","created":1765867176374,"text":"清除database内的所有数据，包括features, frame_ids, agent_id"},"children":[]}]},{"data":{"id":"deylw6sgai00","created":1765783172379,"text":"search_closest_frames()","font-weight":"bold"},"children":[{"data":{"id":"dezfopnk0o80","created":1765867219826,"text":"传入","expandState":"collapse"},"children":[{"data":{"id":"dezfovn2y8w0","created":1765867232858,"text":"agent_id"},"children":[]},{"data":{"id":"dezfoytfivs0","created":1765867239772,"text":"frame_ids"},"children":[]},{"data":{"id":"dezfp2d0pcg0","created":1765867247487,"text":"features"},"children":[]},{"data":{"id":"dezfp6otrq80","created":1765867256908,"text":"use_time_threshold"},"children":[]}]},{"data":{"id":"dezfoqyx46g0","created":1765867222690,"text":"传出","expandState":"expand"},"children":[{"data":{"id":"dezfph89sa00","created":1765867279851,"text":"closest_frames: list"},"children":[]}]},{"data":{"id":"dezfq77aql40","created":1765867336389,"text":"算法"},"children":[]},{"data":{"id":"dezfppppn9s0","created":1765867298320,"text":"从database内寻找最近的帧","font-weight":"bold"},"children":[]}]},{"data":{"id":"deylwgoakp40","created":1765783193895,"text":"detect_intra_loops()","font-weight":"bold"},"children":[{"data":{"id":"dezfqmn06js0","created":1765867369990,"text":"传入"},"children":[{"data":{"id":"dezfqo0ls8w0","created":1765867372989,"text":"agents_submaps: dict"},"children":[]}]},{"data":{"id":"dezfrmnd1ps0","created":1765867448376,"text":"传出"},"children":[{"data":{"id":"dezfronne140","created":1765867452747,"text":"intra_loops: list"},"children":[]}]},{"data":{"id":"dezfs0l5cnk0","created":1765867478717,"text":"寻找不同agent间的回环","font-weight":"bold"},"children":[]}]},{"data":{"id":"deyqfj0yeag0","created":1765795972373,"text":"detect_inter_loops()","font-weight":"bold"},"children":[{"data":{"id":"dezfsk15uj40","created":1765867521044,"text":"传入"},"children":[{"data":{"id":"dezfqo0ls8w0","created":1765867372989,"text":"agents_submaps: dict"},"children":[]}]},{"data":{"id":"dezfsrtw5jc0","created":1765867538019,"text":"传出"},"children":[{"data":{"id":"dezfsuamt280","created":1765867543385,"text":"inter_loops: list"},"children":[]}]},{"data":{"id":"dezfszf3koo0","created":1765867554539,"text":"寻找自回环","font-weight":"bold"},"children":[]}]},{"data":{"id":"deyqfoeg10g0","created":1765795984073,"text":"detect_loops()","font-weight":"bold"},"children":[{"data":{"id":"dezfu4spmhs0","created":1765867644610,"text":"传入"},"children":[{"data":{"id":"dezfqo0ls8w0","created":1765867372989,"text":"agents_submaps: dict"},"children":[]}]},{"data":{"id":"dezfuasnemw0","created":1765867657667,"text":"传出"},"children":[{"data":{"id":"dezfronne140","created":1765867452747,"text":"intra_loops: list"},"children":[]},{"data":{"id":"dezfsuamt280","created":1765867543385,"text":"inter_loops: list"},"children":[]},{"data":{"id":"dezfz44kqao0","created":1765868034971,"text":"注意实际返回的是一个复合类型tuple；两个list用\",\"连接会自动变成一个元组tuple"},"children":[]}]},{"data":{"id":"dezfxfildns0","created":1765867903035,"text":"统一接口，方便外部调用","font-weight":"bold"},"children":[]}]},{"data":{"id":"deyqfs67mao0","created":1765795992282,"text":"filter_loops(loops)","font-weight":"bold"},"children":[{"data":{"id":"dezg12hd1yo0","created":1765868188119,"text":"传入"},"children":[{"data":{"id":"dezg1451k6g0","created":1765868191728,"text":"loops: list"},"children":[]}]},{"data":{"id":"dezg17mis0w0","created":1765868199315,"text":"传出"},"children":[{"data":{"id":"dezg18yd5w80","created":1765868202208,"text":"filtered_loops: list"},"children":[]}]},{"data":{"id":"dezg248g6v40","created":1765868270298,"text":"算法"},"children":[{"data":{"id":"dezg27lcz1c0","created":1765868277609,"text":"利用fitness_threshold和inlier_rmse过滤"},"children":[]},{"data":{"id":"dezg2kls4fk0","created":1765868305933,"text":"loop.fitness怎么来的？"},"children":[]}]},{"data":{"id":"dezg1eegu6g0","created":1765868214066,"text":"过滤不良配准的loop，只加入良好的loop","font-weight":"bold"},"children":[]}]}]},{"data":{"id":"dezezd8818o0","created":1765865233673,"text":"结构","expandState":"expand"},"children":[{"data":{"id":"deylvgrcago0","created":1765783115715,"text":"init(config)","expandState":"collapse"},"children":[{"data":{"id":"deylx3slda00","created":1765783244221,"text":"feature_extractor_name"},"children":[]},{"data":{"id":"deylxc2qcww0","created":1765783262249,"text":"device"},"children":[]},{"data":{"id":"deyly634l0w0","created":1765783327576,"text":"weights_path"},"children":[]},{"data":{"id":"deyly86uug80","created":1765783332155,"text":"feature_dist_threhold"},"children":[]},{"data":{"id":"deylyapj74g0","created":1765783337638,"text":"time_threshold","layout_right_offset":{"x":2,"y":0}},"children":[]},{"data":{"id":"deylyckzvug0","created":1765783341717,"text":"embed_size"},"children":[]},{"data":{"id":"deylye09bds0","created":1765783344817,"text":"max_loops_per_frame"},"children":[]},{"data":{"id":"deylyiyo0jk0","created":1765783355604,"text":"fitness_threshold"},"children":[]},{"data":{"id":"deylyno94rk0","created":1765783365859,"text":"inlier_rmse_threshold"},"children":[]},{"data":{"id":"deylyt5soeg0","created":1765783377803,"text":"agents_ids"},"children":[]},{"data":{"id":"deylyykfvc00","created":1765783389573,"text":"frame_ids"},"children":[]},{"data":{"id":"deylz3yxdjk0","created":1765783401333,"text":"feature_extractor"},"children":[]},{"data":{"id":"deylz6j6rfk0","created":1765783406911,"text":"_setup_feature_db()"},"children":[]}]}]},{"data":{"id":"dezez6sin1s0","created":1765865219663,"text":"功能目的","expandState":"expand"},"children":[{"data":{"id":"dezfhbavb340","created":1765866640035,"text":"寻找相近帧、过滤出回环loop","font-weight":"bold"},"children":[]}]}]}]},{"data":{"id":"deyl9zns6og0","created":1765781432848,"text":"netvlad.py","expandState":"collapse"},"children":[{"data":{"id":"deyqga73alc0","created":1765796031517,"text":"子类NetVLADLayer","expandState":"collapse"},"children":[{"data":{"id":"dezez46hekg0","created":1765865213977,"text":"传入","expandState":"collapse"},"children":[{"data":{"id":"deyqip2ao5c0","created":1765796220608,"text":"继承自nn.Module"},"children":[]},{"data":{"id":"dezg5bgiuds0","created":1765868521116,"text":"input_dim=512 输入特征的维度"},"children":[]},{"data":{"id":"dezg5feyv6g0","created":1765868529729,"text":"K=64 聚类中心的数量"},"children":[]},{"data":{"id":"dezg5hrxdow0","created":1765868534867,"text":"score_bias=False"},"children":[]},{"data":{"id":"dezg5ki2rfs0","created":1765868540801,"text":"intranorm=True"},"children":[]}]},{"data":{"id":"dezez8g26ug0","created":1765865223263,"text":"函数功能"},"children":[{"data":{"id":"dezga40zeio0","created":1765868896760,"text":"forward"},"children":[{"data":{"id":"dezga601hdk0","created":1765868901057,"text":"传入"},"children":[{"data":{"id":"dezgaaaa9e00","created":1765868910383,"text":"局部特征x"},"children":[]}]},{"data":{"id":"dezgag3gui00","created":1765868923032,"text":"传出"},"children":[{"data":{"id":"dezgalkutp40","created":1765868934967,"text":"描述子desc"},"children":[]}]},{"data":{"id":"dezgfnv18zk0","created":1765869331757,"text":"算法"},"children":[]},{"data":{"id":"dezgfpku3n40","created":1765869335494,"text":"处理特征，返回描述子","font-weight":"bold"},"children":[]}]}]},{"data":{"id":"dezezd8818o0","created":1765865233673,"text":"结构","expandState":"expand"},"children":[{"data":{"id":"deyqgfbimlc0","created":1765796042669,"text":"__init__","expandState":"expand"},"children":[{"data":{"id":"deyqizj8az40","created":1765796243399,"text":"score_proj 1D 卷积，计算各中心的分数"},"children":[]},{"data":{"id":"deyqj1nfuu00","created":1765796248007,"text":"centers VLAD 的聚类中心，可学习的参数"},"children":[]},{"data":{"id":"deyqji73s6w0","created":1765796284025,"text":"intranorm 判定指标，是否对每个中心的 residual 做 L2 归一化"},"children":[]},{"data":{"id":"deyqjjr85a80","created":1765796287418,"text":"output_dim 输出描述子的维度"},"children":[]}]}]},{"data":{"id":"dezez6sin1s0","created":1765865219663,"text":"功能目的"},"children":[{"data":{"id":"dezg9tbhs4w0","created":1765868873451,"text":"把一组局部特征聚合成一个固定维度的全局描述子","font-weight":"bold"},"children":[]}]}]},{"data":{"id":"deyqgnkjpuo0","created":1765796060629,"text":"子类NetVLAD","expandState":"collapse"},"children":[{"data":{"id":"dezez46hekg0","created":1765865213977,"text":"传入"},"children":[{"data":{"id":"df2txds9xxc0","created":1766212074676,"text":"conf"},"children":[]}]},{"data":{"id":"dezez8g26ug0","created":1765865223263,"text":"函数功能","expandState":"collapse"},"children":[{"data":{"id":"deyqp87e8ds0","created":1765796732460,"text":"transform","expandState":"expand"},"children":[{"data":{"id":"df2ty331mu80","created":1766212129747,"text":"传入","expandState":"expand"},"children":[{"data":{"id":"df2ty6uf37k0","created":1766212137932,"text":"img: torch.Tensor"},"children":[]}]},{"data":{"id":"df2tyikllkg0","created":1766212163460,"text":"传出"},"children":[{"data":{"id":"df2typjl7i80","created":1766212178636,"text":"torch.clamp(img, min=0, max=1)"},"children":[]}]},{"data":{"id":"deyqqlwl20g0","created":1765796840645,"text":"返回.clamp()格式"},"children":[]},{"data":{"id":"df2u7n4wm5k0","created":1766212878672,"text":"接口兼容函数，实际几乎不用"},"children":[]}]},{"data":{"id":"deyqp9vbokg0","created":1765796736083,"text":"forward","expandState":"expand"},"children":[{"data":{"id":"df2txu7xmdc0","created":1766212110451,"text":"传入"},"children":[{"data":{"id":"df2txxingyw0","created":1766212117630,"text":"image: torch.Tensor"},"children":[]}]},{"data":{"id":"df2txnw4wv40","created":1766212096677,"text":"传出"},"children":[{"data":{"id":"df2txr3j1j40","created":1766212103654,"text":"desc"},"children":[]}]},{"data":{"id":"deyqqfd3ohc0","created":1765796826406,"text":"返回描述子","font-weight":"bold"},"children":[]}]}]},{"data":{"id":"dezezd8818o0","created":1765865233673,"text":"结构","expandState":"collapse"},"children":[{"data":{"id":"deyqgwrzbkw0","created":1765796080670,"text":"类属性default_conf","expandState":"expand"},"children":[{"data":{"id":"deyqh1g05880","created":1765796090829,"text":"\"model_name\": 'VGG16-NetVLAD-Pitts30K'"},"children":[]},{"data":{"id":"deyqh6am5oo0","created":1765796101388,"text":"\"whiten\": True"},"children":[]}]},{"data":{"id":"dezgnfln4u00","created":1765869940688,"text":"类属性required_inputs"},"children":[{"data":{"id":"dezgnmars940","created":1765869955268,"text":"['image']"},"children":[]}]},{"data":{"id":"df2tsvgofd40","created":1766211721336,"text":"类属性dir_models"},"children":[{"data":{"id":"df2ttd76ulk0","created":1766211759944,"text":"'VGG16-NetVLAD-Pitts30K'"},"children":[]},{"data":{"id":"df2ttgdev2o0","created":1766211766851,"text":"'VGG16-NetVLAD-TokyoTM'"},"children":[]}]},{"data":{"id":"deyqlkeg13c0","created":1765796445551,"text":"实例属性__init__","expandState":"collapse"},"children":[{"data":{"id":"deyqlp7zjm80","created":1765796456044,"text":"checkpoint"},"children":[]},{"data":{"id":"deyqlr0karc0","created":1765796459949,"text":"backbone"},"children":[]},{"data":{"id":"deyqlsxf6s00","created":1765796464112,"text":"netvlad"},"children":[]},{"data":{"id":"deyqlvd8nv40","created":1765796469422,"text":"writen"},"children":[]},{"data":{"id":"deyqmu6j3sg0","created":1765796545204,"text":"mat"},"children":[]},{"data":{"id":"deyqmv7dhvk0","created":1765796547432,"text":"weight"},"children":[]},{"data":{"id":"deyqn4l0w7k0","created":1765796567848,"text":"bias"},"children":[]},{"data":{"id":"deyqn5jw3880","created":1765796569957,"text":"score_w"},"children":[{"data":{"id":"deyqnfk9ovs0","created":1765796591747,"text":"NetVLAD的weight"},"children":[]}]},{"data":{"id":"deyqn9a7hmo0","created":1765796578078,"text":"center_w"},"children":[]},{"data":{"id":"deyqnbp8pw00","created":1765796583341,"text":"preprocess{'mean','std'}"},"children":[]}]}]},{"data":{"id":"df2tvg2gmrs0","created":1766211922917,"text":"算法","expandState":"collapse"},"children":[{"data":{"id":"df2tvilq3a80","created":1766211928435,"text":"VGG16"},"children":[]},{"data":{"id":"df2tvkv6upc0","created":1766211933361,"text":"Dense local descriptors"},"children":[]},{"data":{"id":"df2tvogyp4g0","created":1766211941208,"text":"NetVLAD"},"children":[]},{"data":{"id":"df2tvpuv3yw0","created":1766211944225,"text":"Global descriptor"},"children":[]},{"data":{"id":"df2tvssti200","created":1766211950632,"text":"Whitening"},"children":[]},{"data":{"id":"df2tvuhy3kg0","created":1766211954328,"text":"L2 normallize"},"children":[]}]},{"data":{"id":"df2tumz9gvs0","created":1766211859597,"text":"将图像变为全局描述子，VGG16 + NetVLAD + Whitening","font-weight":"bold"},"children":[]}]},{"data":{"id":"dfefarjiwvc0","created":1767389526187,"text":"同样是image->描述子，为loop_detector做准备"},"children":[]}]}]},{"data":{"id":"deyl7gh4dh40","created":1765781234358,"text":"agent.py","font-weight":"bold","expandState":"expand"},"children":[{"data":{"id":"deyqr0jy6mo0","created":1765796872533,"text":"Agent","expandState":"expand","font-weight":"bold"},"children":[{"data":{"id":"dezez46hekg0","created":1765865213977,"text":"传入"},"children":[{"data":{"id":"df2ubs8o48o0","created":1766213203240,"text":"agent_id: int"},"children":[]},{"data":{"id":"df2ubvk7qk00","created":1766213210469,"text":"run_info: dict"},"children":[]},{"data":{"id":"df2uby1t3340","created":1766213215886,"text":"config: dict"},"children":[]}]},{"data":{"id":"dezez8g26ug0","created":1765865223263,"text":"函数功能","expandState":"expand"},"children":[{"data":{"id":"deyqtznr76g0","created":1765797105679,"text":"set_pipe()","expandState":"expand"},"children":[{"data":{"id":"df2udp1v7hc0","created":1766213353027,"text":"传入"},"children":[{"data":{"id":"df2udqvqve80","created":1766213357011,"text":"pipe"},"children":[]}]},{"data":{"id":"df2udt1tv9k0","created":1766213361732,"text":"设置管道用于通信"},"children":[]}]},{"data":{"id":"deyqu48zoyo0","created":1765797115670,"text":"start_new_submap()","expandState":"expand"},"children":[{"data":{"id":"df2udzslzoo0","created":1766213376412,"text":"传入"},"children":[{"data":{"id":"df2ue224uso0","created":1766213381341,"text":"frame_id"},"children":[]},{"data":{"id":"df2ue3hkhs00","created":1766213384451,"text":"gaussian_model"},"children":[]}]},{"data":{"id":"df2uehxekf40","created":1766213415884,"text":"传出"},"children":[{"data":{"id":"df2uekr5rgo0","created":1766213422037,"text":"gaussian_model"},"children":[]}]},{"data":{"id":"df2ugg2x5nc0","created":1766213568592,"text":"算法流程"},"children":[{"data":{"id":"df5lfwequdk0","created":1766492815652,"text":"clone当前GaussianModel"},"children":[]},{"data":{"id":"df5lg3abdhk0","created":1766492830622,"text":"用当前视角render、找可见Gaussian"},"children":[]},{"data":{"id":"df5lgdgxcrc0","created":1766492852790,"text":"裁剪不可见点"},"children":[]},{"data":{"id":"df5lgfgmmog0","created":1766492857125,"text":"保存一个submap ckpt"},"children":[{"data":{"id":"df5lgqhtx080","created":1766492881142,"text":"高斯参数"},"children":[]},{"data":{"id":"df5lgs4g0c80","created":1766492884687,"text":"c2w, gt_c2w"},"children":[]},{"data":{"id":"df5lgvzczhc0","created":1766492893086,"text":"keyframes"},"children":[]},{"data":{"id":"df5lgxktwjk0","created":1766492896561,"text":"submap feature"},"children":[]},{"data":{"id":"df5lgzco03c0","created":1766492900421,"text":"点云"},"children":[]}]},{"data":{"id":"df5lh2hej4g0","created":1766492907238,"text":"新建空GaussianModel"},"children":[]},{"data":{"id":"df5lh6tnbds0","created":1766492916685,"text":"submap_id += 1"},"children":[]},{"data":{"id":"df5lhaplxq80","created":1766492925148,"text":"记录submap起始frame"},"children":[]}]},{"data":{"id":"df2uf3h2mrs0","created":1766213462786,"text":"先保存当前submap，再初始化新子图，传出为一个新的，重设的GausianModel submap"},"children":[]}]},{"data":{"id":"deyqudj7sf40","created":1765797135879,"text":"_init_wandb()","expandState":"collapse"},"children":[{"data":{"id":"df2ugs0qsco0","created":1766213594582,"text":"初始化wandb logger"},"children":[]}]},{"data":{"id":"deyquhcmrls0","created":1765797144188,"text":"should_start_new_submap()","expandState":"collapse"},"children":[{"data":{"id":"df2ugxzw2bk0","created":1766213607591,"text":"传入"},"children":[{"data":{"id":"df2uh0kgj7k0","created":1766213613188,"text":"frame_id"},"children":[]}]},{"data":{"id":"df2uh8y4yhs0","created":1766213631430,"text":"传出"},"children":[{"data":{"id":"df2uhaxn09s0","created":1766213635753,"text":"frame_id % self.config[\"mapping\"][\"new_submap_every\"] == 0"},"children":[]},{"data":{"id":"df2uhxivxw80","created":1766213684927,"text":"实际是返回true or false, 每xx张图新建子图"},"children":[]}]},{"data":{"id":"df2uiael71c0","created":1766213712965,"text":"判断是否需要新建子图，若过了x帧则新建"},"children":[]}]},{"data":{"id":"deyqupkbnew0","created":1765797162068,"text":"should_start_mapping(frame_id)","expandState":"expand"},"children":[{"data":{"id":"df2uitbaeao0","created":1766213754125,"text":"传入"},"children":[{"data":{"id":"df2uiw1ys8g0","created":1766213760091,"text":"frame_id"},"children":[]}]},{"data":{"id":"df2uiybr5ug0","created":1766213765037,"text":"传出"},"children":[{"data":{"id":"df2uj0hc5kg0","created":1766213769728,"text":"frame_id % self.config[\"mapping\"][\"map_every\"] == 0"},"children":[]}]},{"data":{"id":"df2vfka6fmg0","created":1766216320484,"text":"判断是否需要开始mapping，每y帧做mapping (这里备注里写的若使用原新建方案，但并没有原判断方案，可能是残留备注吧)"},"children":[]}]},{"data":{"id":"deyquuwf1c00","created":1765797173683,"text":"get_submap_data(frame_id, gaussian_model)","expandState":"collapse"},"children":[{"data":{"id":"df2vh3zk12o0","created":1766216441741,"text":"传入"},"children":[{"data":{"id":"df2vh59199s0","created":1766216444491,"text":"frame_id"},"children":[]},{"data":{"id":"df2vh7pfn8w0","created":1766216449837,"text":"gaussian_model"},"children":[]}]},{"data":{"id":"df2vh9w9sqo0","created":1766216454604,"text":"传出"},"children":[{"data":{"id":"df2vhbwmyao0","created":1766216458979,"text":"dict","expandState":"collapse"},"children":[{"data":{"id":"df2vhwfm7e00","created":1766216503662,"text":"agent_id"},"children":[]},{"data":{"id":"df2vhxwv2ds0","created":1766216506882,"text":"submap_id"},"children":[]},{"data":{"id":"df2vhzkzl7k0","created":1766216510518,"text":"gaussian_model_params"},"children":[]},{"data":{"id":"df2vi2irqcw0","created":1766216516914,"text":"submap_start_frame_id"},"children":[]},{"data":{"id":"df2vieq96rc0","created":1766216543488,"text":"submap_end_frame_id"},"children":[]},{"data":{"id":"df2vjpesvkw0","created":1766216645104,"text":"submap_c2ws"},"children":[]},{"data":{"id":"df2vjsqg70g0","created":1766216652339,"text":"keyframe_ids"},"children":[]},{"data":{"id":"df2vjvx4bls0","created":1766216659272,"text":"submap_features"},"children":[]},{"data":{"id":"df2vjyknpj40","created":1766216665049,"text":"point_cloud"},"children":[]}]}]},{"data":{"id":"df2vk2bcc9c0","created":1766216673193,"text":"导出submap内的数据"},"children":[]}]},{"data":{"id":"deyqva7ta5s0","created":1765797207024,"text":"init_map()","expandState":"collapse"},"children":[{"data":{"id":"df2vkvk5ejs0","created":1766216736852,"text":"传出"},"children":[{"data":{"id":"df2vkxdioeo0","created":1766216740805,"text":"gaussian_model"},"children":[]}]},{"data":{"id":"df2vltz6rnk0","created":1766216811772,"text":"算法"},"children":[{"data":{"id":"df5la2o7lgg0","created":1766492359100,"text":"创建一个空GaussianModel"},"children":[]},{"data":{"id":"df5la6liuhk0","created":1766492367645,"text":"调用training_setup"},"children":[]},{"data":{"id":"df5laa9e2k00","created":1766492375620,"text":"用GT pose第0帧进行mapping"},"children":[]},{"data":{"id":"df5lag9cleo0","created":1766492388677,"text":"设置第零帧c2ws=gt_c2ws[0]"},"children":[]}]},{"data":{"id":"df2vl21r4lk0","created":1766216750977,"text":"用第一帧GT初始化mapping，设置gaussian model和mapping的第一帧"},"children":[]}]},{"data":{"id":"deyqvdhm0nk0","created":1765797214146,"text":"run()","font-weight":"bold","expandState":"expand"},"children":[{"data":{"id":"df2vma85f4o0","created":1766216847143,"text":"流程","expandState":"expand"},"children":[{"data":{"id":"df5l8u83ebs0","created":1766492262348,"text":"全局初始化","expandState":"collapse"},"children":[{"data":{"id":"df5l8za5l480","created":1766492273356,"text":"打印\"Starting agent\""},"children":[]},{"data":{"id":"df5l93iut080","created":1766492282589,"text":"setup_seed()"},"children":[]}]},{"data":{"id":"df5l8vszv880","created":1766492265788,"text":"WandB判断和初始化","expandState":"collapse"},"children":[{"data":{"id":"df5l9evafzs0","created":1766492307286,"text":"self._init_wandb()"},"children":[]}]},{"data":{"id":"df5l9jri15s0","created":1766492317941,"text":"初始化第一张图","expandState":"collapse"},"children":[{"data":{"id":"df5l9q51v4w0","created":1766492331821,"text":"gaussian_model=self.init_map()"},"children":[]}]},{"data":{"id":"df5l9xf5us80","created":1766492347669,"text":"提取第一个submap特征","expandState":"collapse"},"children":[{"data":{"id":"df5lbtpmrnk0","created":1766492496324,"text":"image=Image.fromarray()"},"children":[]},{"data":{"id":"df5lbz5ubmo0","created":1766492508188,"text":"self.submap_features[self.submap_id]=feature_extractor(image)"},"children":[]}]},{"data":{"id":"df5lcgecv5s0","created":1766492545708,"text":"主循环：遍历后续所有帧","expandState":"expand"},"children":[{"data":{"id":"df5lcono7co0","created":1766492563685,"text":"第一步：Tracking估计位姿","expandState":"collapse"},"children":[{"data":{"id":"df5lctcr6y80","created":1766492573909,"text":"frame1: GT pose"},"children":[{"data":{"id":"dfefyflzql40","created":1767391380955,"text":"estimated_c2w = self.dataset[frame_id][-1]"},"children":[]}]},{"data":{"id":"df5lcx93qcw0","created":1766492582396,"text":"frame>=2:"},"children":[{"data":{"id":"df5ld0zfaqw0","created":1766492590517,"text":"输入"},"children":[{"data":{"id":"df5ld5wlbmg0","created":1766492601230,"text":"当前gaussian map"},"children":[]},{"data":{"id":"df5ld8dqbds0","created":1766492606620,"text":"c2w (0, t-2, t-1)"},"children":[]}]},{"data":{"id":"df5ldw4y1ao0","created":1766492658332,"text":"输出"},"children":[{"data":{"id":"df5le09owxc0","created":1766492667326,"text":"当前帧估计位姿estimated_c2w"},"children":[]}]},{"data":{"id":"dfefy6321u00","created":1767391360219,"text":"estimated_c2w = self.tracker.track(\n\t                frame_id, gaussian_model,\n\t                torch2np(self.estimated_c2ws[torch.tensor([0, frame_id - 2, frame_id - 1])]))"},"children":[]}]}]},{"data":{"id":"df5led2h6ns0","created":1766492695188,"text":"第二步：为mapping准备GaussianModel","expandState":"collapse"},"children":[{"data":{"id":"df5lekav6zs0","created":1766492710932,"text":"gaussian_model.training_setup()"},"children":[]}]},{"data":{"id":"df5leqvb5ag0","created":1766492725229,"text":"第三步：判断是否需要start_new_submap，若是：","expandState":"collapse"},"children":[{"data":{"id":"dfefn2d47jc0","created":1767390490114,"text":"保存位姿，保存并新建位子图","expandState":"expand"},"children":[{"data":{"id":"df5lf15broo0","created":1766492747603,"text":"保存当前估计轨迹"},"children":[{"data":{"id":"dfefeojq9go0","created":1767389833126,"text":"save_dict_to_ckpt(self.estimated_c2ws[:frame_id + 1], \"estimated_c2w.ckpt\", directory=self.output_path)"},"children":[]}]},{"data":{"id":"df5lf9v71k00","created":1766492766581,"text":"保存并结束旧submap+新建submap"},"children":[{"data":{"id":"dfefhaqzdeo0","created":1767390038182,"text":"gaussian_model = self.start_new_submap(frame_id, gaussian_model)"},"children":[]}]}]},{"data":{"id":"dfefwr8tlwo0","created":1767391249552,"text":"做第一帧的map，并提取第一帧的features用于loop_detector","expandState":"expand"},"children":[{"data":{"id":"dfefzf2pysg0","created":1767391458154,"text":"将第一帧id新增至关键帧列表"},"children":[{"data":{"id":"dfefztslu2w0","created":1767391490194,"text":"self.keyframe_ids.append(frame_id)"},"children":[]}]},{"data":{"id":"df5ll05s3pk0","created":1766493215638,"text":"设置广播种子=True并设置max_iterations为new submap迭代次数"},"children":[{"data":{"id":"dfeg0245lew0","created":1767391508307,"text":"extensive_seeding, max_iterations = True, self.mapper.new_submap_iterations"},"children":[]}]},{"data":{"id":"df5ljrydb2g0","created":1766493119412,"text":"新Submap的首次强mapping"},"children":[{"data":{"id":"dfeg08eol9c0","created":1767391522004,"text":"self.mapper.map(frame_id, estimated_c2w, gaussian_model, extensive_seeding, max_iterations)"},"children":[]}]},{"data":{"id":"df5llv4u5gg0","created":1766493283062,"text":"提取新submap特征"},"children":[{"data":{"id":"dfeg0jv2rio0","created":1767391546940,"text":"image = Image.fromarray(self.dataset[frame_id][1])\n\t            self.submap_features[self.submap_id] = self.feature_extractor.extract_features(image).cpu().numpy()"},"children":[]}]}]}]},{"data":{"id":"df5leyfkyow0","created":1766492741692,"text":"第四步：若不新建子图，判断是否需要mapping，若是：","expandState":"collapse"},"children":[{"data":{"id":"dfeg1oewqrc0","created":1767391635210,"text":"新增该帧id至关键帧"},"children":[{"data":{"id":"dfeg1y9j1c80","created":1767391656653,"text":"self.keyframe_ids.append(frame_id)"},"children":[]}]},{"data":{"id":"dfeg1vh38t40","created":1767391650580,"text":"不广播本帧，重设循环次数为普通mapper的循环"},"children":[{"data":{"id":"dfeg2xxeyjk0","created":1767391734284,"text":"extensive_seeding, max_iterations = False, self.mapper.iterations"},"children":[]}]},{"data":{"id":"dfeg30xwjb40","created":1767391740844,"text":"map"},"children":[{"data":{"id":"dfeg35vxafs0","created":1767391751609,"text":"self.mapper.map(frame_id, estimated_c2w, gaussian_model, extensive_seeding, max_iterations)"},"children":[]}]}]}]},{"data":{"id":"df5lp2r5p3k0","created":1766493534741,"text":"多gpu下记录gpu使用情况：判断是否为multi_gpu，若是：","expandState":"collapse"},"children":[{"data":{"id":"dfeg3v8h0k80","created":1767391806787,"text":"记录本agent的gpu使用情况，注意0号gpu给服务器了，所以此处agent_id+1","expandState":"expand"},"children":[{"data":{"id":"df5lp8f5kc80","created":1766493547076,"text":"self.logger.log_gpu_usage(self.agent_id + 1)"},"children":[]}]}]},{"data":{"id":"df5lrs9792o0","created":1766493746980,"text":"保存所有submap","expandState":"collapse"},"children":[{"data":{"id":"df5lslb1gg80","created":1766493810218,"text":"存储submap名并扩展至6位"},"children":[{"data":{"id":"dfeg8jqbv0g0","created":1767392173566,"text":"submap_ckpt_name = str(self.submap_id).zfill(6)"},"children":[]}]},{"data":{"id":"df5lt8rbwx40","created":1766493861269,"text":"获取并存储submap数据","expandState":"expand"},"children":[{"data":{"id":"df5lst74t8g0","created":1766493827396,"text":"submap_data = self.get_submap_data(frame_id, gaussian_model)\n\t    save_dict_to_ckpt(submap_data, f\"{submap_ckpt_name}.ckpt\", directory=self.output_path / \"submaps\")"},"children":[]}]}]},{"data":{"id":"dfehppy1q600","created":1767396340394,"text":"上传submap","expandState":"collapse"},"children":[{"data":{"id":"dfehzdz5eew0","created":1767397097981,"text":"初始化agents_submaps列表"},"children":[]},{"data":{"id":"dfehsnqbn5c0","created":1767396570666,"text":"读取所有path在output_path下的submap文件并排序"},"children":[{"data":{"id":"dfehukeg6fc0","created":1767396720146,"text":"for submap_path in sorted((self.output_path / \"submaps\").glob(\"*\")):"},"children":[]}]},{"data":{"id":"dfehu7or8vc0","created":1767396692471,"text":"读取submap对象"},"children":[{"data":{"id":"dfehx0ijdf40","created":1767396911950,"text":" agent_submap = torch.load(submap_path, map_location=\"cpu\", weights_only=False)"},"children":[]},{"data":{"id":"dfehx50iys00","created":1767396921745,"text":"(这一步叫反序列化，序列化就是把对象存储成二进制文件等格式的过程)"},"children":[]}]},{"data":{"id":"dfehx664cp40","created":1767396924260,"text":"将子图加入agents_submaps，构成一个存储agent_submap字典的列表"},"children":[{"data":{"id":"dfehzausm140","created":1767397091187,"text":"agents_submaps.append(agent_submap)"},"children":[]}]},{"data":{"id":"dfeif5ftnsg0","created":1767398333225,"text":"上传agents_submaps"},"children":[{"data":{"id":"dfeiff6p62o0","created":1767398354441,"text":"self.pipe.send((\"pgo\", agents_submaps))"},"children":[]},{"data":{"id":"dfeifhrw4u00","created":1767398360076,"text":"这里用的.send是一次性上传，也就是说如果每个map的gap设的很大的话，数据量会线性增长，这个通信设计就很离谱","font-weight":"bold"},"children":[]}]}]},{"data":{"id":"dfehzlnh1m00","created":1767397114689,"text":"获取服务器优化完毕的pose","expandState":"collapse"},"children":[{"data":{"id":"dfei4v1bjns0","created":1767397526939,"text":"optimized_kf_poses = self.pipe.recv()"},"children":[]},{"data":{"id":"dfei8zxhjps0","created":1767397851047,"text":"这里居然直接用recv()阻塞进程！大痛点啊","font-weight":"bold"},"children":[]}]},{"data":{"id":"dfeih396olc0","created":1767398485198,"text":"手动释放tracker防止内存泄漏","expandState":"collapse"},"children":[{"data":{"id":"dfeivm0u6wo0","created":1767399623151,"text":"self.tracker = None"},"children":[]}]},{"data":{"id":"dfeivtfyfog0","created":1767399639302,"text":"分别记录未优化和已优化后的tracking结果","expandState":"collapse"},"children":[{"data":{"id":"dfeiwd6k7pc0","created":1767399682270,"text":"self.logger.log_tracking_results(self.estimated_c2ws[self.keyframe_ids],\n\t                                     self.gt_c2ws[self.keyframe_ids], \"kfs.png\")\n\t    self.logger.log_tracking_results(optimized_kf_poses,\n\t                                     self.gt_c2ws[self.keyframe_ids], \"optimized_kfs.png\")"},"children":[]}]},{"data":{"id":"dfeiydhovfs0","created":1767399839671,"text":"存储各种结果到ckpt文件，存储格式为tensor","expandState":"collapse"},"children":[{"data":{"id":"dfej19ycvg00","created":1767400067064,"text":"keyframe_ids，一维tensor"},"children":[{"data":{"id":"dfejubhi28o0","created":1767402342959,"text":"save_dict_to_ckpt(np2torch(np.array(self.keyframe_ids)), \"kf_ids.ckpt\", directory=self.output_path)"},"children":[]}]},{"data":{"id":"dfejh5m1xmo0","created":1767401311440,"text":"估算的关键帧位姿estimated_c2ws, 三维tensor(num, 4, 4)"},"children":[{"data":{"id":"dfejuf8opvs0","created":1767402351133,"text":"save_dict_to_ckpt(self.estimated_c2ws[self.keyframe_ids], \"estimated_kf_c2w.ckpt\", directory=self.output_path)"},"children":[]}]},{"data":{"id":"dfejhwhu72o0","created":1767401369958,"text":"优化后关键帧位姿optimized_kf_pose，结构同上"},"children":[{"data":{"id":"dfejujm3nqg0","created":1767402360652,"text":"save_dict_to_ckpt(np2torch(optimized_kf_poses), \"optimized_kf_c2w.ckpt\", directory=self.output_path)"},"children":[]}]},{"data":{"id":"dfeji4x7zf40","created":1767401388302,"text":"子图submap, 为了完整存下，这里的frame_id+1","expandState":"expand"},"children":[{"data":{"id":"dfejt9s9n4w0","created":1767402260893,"text":"submap命名及拓展"},"children":[{"data":{"id":"dfejtm1dlx40","created":1767402287565,"text":"        submap_ckpt_name = str(self.submap_id).zfill(6)"},"children":[]}]},{"data":{"id":"dfejpw5migw0","created":1767401996133,"text":"submap_data"},"children":[{"data":{"id":"dfejtp8qyhs0","created":1767402294541,"text":"submap_data = self.get_submap_data(frame_id + 1, gaussian_model)\n\t    save_dict_to_ckpt(submap_data, f\"{submap_ckpt_name}.ckpt\", directory=self.output_path / \"submaps\")"},"children":[]}]}]},{"data":{"id":"dfejpzij5ug0","created":1767402003444,"text":"估算的位姿estimated_c2ws"},"children":[{"data":{"id":"dfeju3e4how0","created":1767402325341,"text":"save_dict_to_ckpt(self.estimated_c2ws[:frame_id + 1], \"estimated_c2w.ckpt\", directory=self.output_path)"},"children":[]}]},{"data":{"id":"dfejfy9s4vc0","created":1767401217096,"text":"简单学习了一下tensor的存取，[start:stop:step,start:stop:step,...]按维度往下取"},"children":[]}]}]},{"data":{"id":"df2vm4623ds0","created":1766216833955,"text":"用于启动整个agent工作流"},"children":[]}]}]},{"data":{"id":"dezezd8818o0","created":1765865233673,"text":"结构","expandState":"expand"},"children":[{"data":{"id":"deyqr3a8jk80","created":1765796878477,"text":"__init__()","expandState":"collapse"},"children":[{"data":{"id":"deyqw1fc9800","created":1765797266252,"text":"device"},"children":[]},{"data":{"id":"deyqw2ganig0","created":1765797268486,"text":"config"},"children":[]},{"data":{"id":"deyqw3obmls0","created":1765797271148,"text":"agent_id"},"children":[]},{"data":{"id":"deyqw4vv1340","created":1765797273781,"text":"run_info"},"children":[]},{"data":{"id":"deyqw6ehxn40","created":1765797277085,"text":"output_path"},"children":[]},{"data":{"id":"deyqw7vdn6w0","created":1765797280282,"text":"scene_name"},"children":[]},{"data":{"id":"deyqwb5gumg0","created":1765797287423,"text":"dataset_name"},"children":[]},{"data":{"id":"deyqwdqu4ag0","created":1765797293068,"text":"agent_input_path"},"children":[]},{"data":{"id":"deyqwoc3je80","created":1765797316122,"text":"dataset"},"children":[]},{"data":{"id":"deyqx2hcq080","created":1765797346914,"text":"estimated_c2ws"},"children":[]},{"data":{"id":"deyqx4mmw5c0","created":1765797351587,"text":"gt_c2ws"},"children":[]},{"data":{"id":"deyqx6fcqzs0","created":1765797355501,"text":"keyframe_ids"},"children":[]},{"data":{"id":"deyqxco2ej40","created":1765797369088,"text":"submap_features"},"children":[]},{"data":{"id":"deyqxfwu1rs0","created":1765797376149,"text":"submap_id"},"children":[]},{"data":{"id":"deyqxhw4icg0","created":1765797380459,"text":"submap_start_frame_ids"},"children":[]},{"data":{"id":"deyqxmhcsio0","created":1765797390450,"text":"opt"},"children":[]},{"data":{"id":"deyqxrx5xk00","created":1765797402290,"text":"log_color"},"children":[]},{"data":{"id":"deyqxu3emc80","created":1765797407021,"text":"logger"},"children":[]},{"data":{"id":"deyqxvvqbvk0","created":1765797410911,"text":"mapper"},"children":[]},{"data":{"id":"deyqxxwwsf40","created":1765797415335,"text":"tracker"},"children":[]},{"data":{"id":"deyqy91os2g0","created":1765797439569,"text":"feature_extractor"},"children":[]}]}]},{"data":{"id":"df2ucwd4nm80","created":1766213290581,"text":"算法详见run"},"children":[]},{"data":{"id":"df2ud2wmelc0","created":1766213304821,"text":"单机器人agent的tracking和mapping流"},"children":[]}]}]},{"data":{"id":"deyl7jaxqe80","created":1765781240514,"text":"arguments.py"},"children":[{"data":{"id":"dfes6efjlb40","created":1767425858621,"text":"GroupParams"},"children":[{"data":{"id":"dfes6kd2yw00","created":1767425871532,"text":"空类，用于存储"},"children":[]}]},{"data":{"id":"dfes6o6too80","created":1767425879861,"text":"母类ParamGroup"},"children":[{"data":{"id":"dfes77v67nc0","created":1767425922692,"text":"传入"},"children":[{"data":{"id":"dfes7ea22vc0","created":1767425936653,"text":"parser: ArgumentParser"},"children":[]},{"data":{"id":"dfes7khzsm00","created":1767425950194,"text":"name: str"},"children":[]},{"data":{"id":"dfes7q7084w0","created":1767425962590,"text":"fill_none=False"},"children":[]}]},{"data":{"id":"dfes79m9ws80","created":1767425926508,"text":"函数"},"children":[{"data":{"id":"dfet0zasl2o0","created":1767428254971,"text":"extract(self, args)"},"children":[{"data":{"id":"dfet14gfa600","created":1767428266195,"text":"传入"},"children":[{"data":{"id":"dfet15uz85c0","created":1767428269252,"text":"设定的训练参数args,一般是namespace对象"},"children":[]}]},{"data":{"id":"dfet1ebo6h40","created":1767428287675,"text":"传出"},"children":[{"data":{"id":"dfet1fvjd3s0","created":1767428291053,"text":"一个GroupParams类group"},"children":[]}]},{"data":{"id":"dfet8npgf3s0","created":1767428856649,"text":"新建一个GroupParams类，用于临时加一些需设置的属性"},"children":[]}]}]},{"data":{"id":"dfes7asogy00","created":1767425929072,"text":"结构"},"children":[{"data":{"id":"dfesg1qv7340","created":1767426614649,"text":"group,用于参数分组，方便查看-h"},"children":[{"data":{"id":"dfesge5ktyo0","created":1767426641660,"text":"group = parser.add_argument_group(name)"},"children":[]}]},{"data":{"id":"dfesggquqy00","created":1767426647300,"text":"对自身字典的所有(key, value)统一格式："},"children":[{"data":{"id":"dfesk2ee8jc0","created":1767426929528,"text":"可缩写的参数：以\"_\"开头_param，创建--param和-p，区分参数是否为bool格式，因为命令行里输入时，bool值不好保存(\"True\",\"False\")"},"children":[{"data":{"id":"dfesxapci3s0","created":1767427966339,"text":"for key, value in vars(self).items(): # vars(self)返回对象的属性字典, items()返回键值对(key, value)\n\t        shorthand = False\n\t        if key.startswith(\"_\"):\n\t            shorthand = True\n\t            key = key[1:]\n\t        t = type(value)\n\t        value = value if not fill_none else None\n\t        if shorthand:\n\t            if t == bool:\n\t                group.add_argument(\n\t                    \"--\" + key, (\"-\" + key[0:1]), default=value, action=\"store_true\")\n\t            else:\n\t                group.add_argument(\n\t                    \"--\" + key, (\"-\" + key[0:1]), default=value, type=t)"},"children":[]}]},{"data":{"id":"dfesxtl0yc00","created":1767428007436,"text":"否则直接创建--param"},"children":[{"data":{"id":"dfet0rjt3xs0","created":1767428238101,"text":"else:\n\t            if t == bool:\n\t                group.add_argument(\n\t                    \"--\" + key, default=value, action=\"store_true\")\n\t            else:\n\t                group.add_argument(\"--\" + key, default=value, type=t)"},"children":[]}]}]}]},{"data":{"id":"dfes7blcnp40","created":1767425930805,"text":"目的"},"children":[{"data":{"id":"dfesi6n5x7k0","created":1767426782037,"text":"母类，批量为所带参数的-h做标准化处理"},"children":[]}]}]},{"data":{"id":"dfi4egiqis80","created":1767765023269,"text":"子类OptimizationParams()"},"children":[{"data":{"id":"dfi4ep49a6o0","created":1767765041985,"text":"结构","expandState":"expand"},"children":[{"data":{"id":"dfi4gdeqazk0","created":1767765173225,"text":"iterations总优化迭代次数"},"children":[]},{"data":{"id":"dfi4gjsc0gw0","created":1767765187108,"text":"位姿学习率"},"children":[{"data":{"id":"dfi4gpoqjvk0","created":1767765199952,"text":"初始学习率position_lr_init"},"children":[]},{"data":{"id":"dfi4gte9kds0","created":1767765208025,"text":"最终学习率position_lr_final"},"children":[]},{"data":{"id":"dfi4gvt7v480","created":1767765213283,"text":"延迟系数position_lr_delay_mult"},"children":[]},{"data":{"id":"dfi4gza409c0","created":1767765220835,"text":"最大调度步数position_lr_max_steps"},"children":[]}]},{"data":{"id":"dfi4lag0pc00","created":1767765558593,"text":"gaussian本身的参数学习率feature_lr"},"children":[]},{"data":{"id":"dfi4lje1xjs0","created":1767765578066,"text":"不透明度学习率opacity_lr"},"children":[]},{"data":{"id":"dfi4lo4vae80","created":1767765588394,"text":"高斯尺度scaling_lr"},"children":[]},{"data":{"id":"dfi4ltqhmuo0","created":1767765600585,"text":"高斯的方向rotation_lr"},"children":[]},{"data":{"id":"dfi4lyfyjbc0","created":1767765610833,"text":"稀疏到稠密的控制参数percent_dense"},"children":[]},{"data":{"id":"dfi4m5nal2w0","created":1767765626514,"text":"感知损失lambda_dssim, DSSIM=1-SSIM"},"children":[]},{"data":{"id":"dfi4mavk6s80","created":1767765637897,"text":"每100步检查哪些地方加入Gaussian densification_interval"},"children":[]},{"data":{"id":"dfi4n297io80","created":1767765697496,"text":"每3000步重置opacity opacity_reset_interval"},"children":[]},{"data":{"id":"dfi4nbvggdc0","created":1767765718432,"text":"前500步不做densify densify_from_iter"},"children":[]},{"data":{"id":"dfi4ni9efz40","created":1767765732336,"text":"15000步后停止densify densify_until_iter"},"children":[]},{"data":{"id":"dfi4olymq280","created":1767765818756,"text":"哪里学不会就在哪里加容量densify_grad_threshold"},"children":[]},{"data":{"id":"dfi4ow6y4dc0","created":1767765841027,"text":"父类继承"},"children":[{"data":{"id":"dfi4rja32jc0","created":1767766048011,"text":"super().__init__(parser, \"Optimization Parameters\")"},"children":[]}]}]},{"data":{"id":"dfi4rzr2cvs0","created":1767766083866,"text":"函数"},"children":[{"data":{"id":"dfi4s1g1eio0","created":1767766087553,"text":"get_combined_args(parser)"},"children":[{"data":{"id":"dfi4s90pc4g0","created":1767766104040,"text":"传入"},"children":[{"data":{"id":"dfi4scavrew0","created":1767766111186,"text":"已注册好所有参数的parser"},"children":[]}]},{"data":{"id":"dfi4socaz140","created":1767766137393,"text":"传出"},"children":[{"data":{"id":"dfi4spsz82o0","created":1767766140578,"text":"可用的Namespace"},"children":[]}]},{"data":{"id":"dfi6kzehn4w0","created":1767771176776,"text":"算法"},"children":[{"data":{"id":"dfi6plcbjts0","created":1767771537991,"text":"详见代码"},"children":[]}]},{"data":{"id":"dfi6l33pkyg0","created":1767771184832,"text":"合并命令行及默认的参数"},"children":[]}]}]},{"data":{"id":"dfi4g1tp4gw0","created":1767765148009,"text":"设置gaussian_model优化阶段的超参数，并接收和合并命令行传入的超参数，主要用于mapping步骤(tracker的在config文件夹下的yaml文件里)"},"children":[]}]}]},{"data":{"id":"deyl7lbksx40","created":1765781244906,"text":"datasets.py"},"children":[{"data":{"id":"dfisnxitt8o0","created":1767833472195,"text":"母类BaseDataset()"},"children":[{"data":{"id":"dfivmkj8f8o0","created":1767841828887,"text":"继承自torch.utils.data.Dataset"},"children":[]},{"data":{"id":"dfivmzt3tjc0","created":1767841862136,"text":"结构"},"children":[{"data":{"id":"dfivn2pzdmg0","created":1767841868477,"text":"dataset_path"},"children":[]},{"data":{"id":"dfivn5dnduo0","created":1767841874262,"text":"frame_limit"},"children":[]},{"data":{"id":"dfivn89vsao0","created":1767841880565,"text":"分支主题"},"children":[]}]}]},{"data":{"id":"dfivm6c4wyg0","created":1767841797983,"text":"子类Replica()"},"children":[]},{"data":{"id":"dfivmcvx3q80","created":1767841812240,"text":"get_dataset()"},"children":[]}]},{"data":{"id":"deyl7nkcge80","created":1765781249790,"text":"gaussian_model.py","font-weight":"bold"},"children":[]},{"data":{"id":"deyl7qrjxvc0","created":1765781256756,"text":"logger.py"},"children":[]},{"data":{"id":"deyl7t14gzs0","created":1765781261688,"text":"losses.py"},"children":[]},{"data":{"id":"deyl7urcrp40","created":1765781265451,"text":"magic_slam.py","font-weight":"bold"},"children":[]},{"data":{"id":"deyl7y7sjio0","created":1765781272976,"text":"mapper.py","font-weight":"bold"},"children":[]},{"data":{"id":"deyl7zyy5lc0","created":1765781276794,"text":"pose_graph_adapter.py"},"children":[]},{"data":{"id":"deyl84xa7lc0","created":1765781287578,"text":"tracker.py","font-weight":"bold"},"children":[]},{"data":{"id":"deyl89uqeso0","created":1765781298307,"text":"visual_odometer.py","font-weight":"bold"},"children":[]}]},{"data":{"id":"deyl74ebz9k0","created":1765781208068,"text":"utils","expandState":"collapse"},"children":[{"data":{"id":"deyl8hjufps0","created":1765781315063,"text":"gaussian_model_utils.py"},"children":[]},{"data":{"id":"deyl8l368jk0","created":1765781322762,"text":"io_utils.py"},"children":[]},{"data":{"id":"deyl8nfmqq80","created":1765781327869,"text":"magic_slam_utils.py"},"children":[]},{"data":{"id":"deyl8uquqbc0","created":1765781343785,"text":"mapping_eval.py"},"children":[]},{"data":{"id":"deyl8ym8ecw0","created":1765781352213,"text":"mapping_utils.py"},"children":[]},{"data":{"id":"deyl91ct6800","created":1765781358173,"text":"tracking_utils.py"},"children":[]},{"data":{"id":"deyl94rx1fc0","created":1765781365617,"text":"utils.py"},"children":[]},{"data":{"id":"deyl96te0og0","created":1765781370060,"text":"vis_utils.py"},"children":[]}]}]},{"data":{"id":"deyl62elgd40","created":1765781125366,"text":"run_slam.py"},"children":[]},{"data":{"id":"deyl6xh0q000","created":1765781192993,"text":"run_visualization.py"},"children":[]}]},{"data":{"id":"deyl5n8a3jc0","created":1765781092332,"text":"scripts"},"children":[]}]},"template":"default","theme":"fresh-blue","version":"1.4.43"}